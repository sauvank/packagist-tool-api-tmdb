<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>packagist-toot-api-tmdb: DeepCopy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">packagist-toot-api-tmdb
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DeepCopy </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>DeepCopy helps you create deep copies (clones) of your objects. It is designed to handle cycles in the association graph.</p>
<p><a href="https://travis-ci.org/myclabs/DeepCopy"></a> <a href="https://coveralls.io/r/myclabs/DeepCopy?branch=1.x"></a> <a href="https://scrutinizer-ci.com/g/myclabs/DeepCopy/"></a> <a href="https://packagist.org/packages/myclabs/deep-copy"></a></p>
<h2>Table of Contents</h2>
<ol type="1">
<li><a href="#how">How</a></li>
</ol>
<ol type="1">
<li><a href="#why">Why</a><ol type="a">
<li><a href="#using-simply-clone">Using simply <code>clone</code></a></li>
</ol>
<ol type="a">
<li><a href="#overridding-__clone">Overridding <code>__clone()</code></a></li>
</ol>
<ol type="a">
<li><a href="#with-deepcopy">With <code>DeepCopy</code></a></li>
</ol>
</li>
</ol>
<ol type="1">
<li><a href="#how-it-works">How it works</a></li>
</ol>
<ol type="1">
<li><a href="#going-further">Going further</a><ol type="a">
<li><a href="#matchers">Matchers</a><ol type="i">
<li><a href="#property-name">Property name</a></li>
</ol>
<ol type="i">
<li><a href="#specific-property">Specific property</a></li>
</ol>
<ol type="i">
<li><a href="#type">Type</a></li>
</ol>
</li>
</ol>
<ol type="a">
<li><a href="#filters">Filters</a><ol type="i">
<li><a href="#setnullfilter-filter"><code>SetNullFilter</code></a></li>
</ol>
<ol type="i">
<li><a href="#keepfilter-filter"><code>KeepFilter</code></a></li>
</ol>
<ol type="i">
<li><a href="#doctrinecollectionfilter-filter"><code>DoctrineCollectionFilter</code></a></li>
</ol>
<ol type="i">
<li><a href="#doctrineemptycollectionfilter-filter"><code>DoctrineEmptyCollectionFilter</code></a></li>
</ol>
<ol type="i">
<li><a href="#doctrineproxyfilter-filter"><code>DoctrineProxyFilter</code></a></li>
</ol>
<ol type="i">
<li><a href="#replacefilter-type-filter"><code>ReplaceFilter</code></a></li>
</ol>
<ol type="i">
<li><a href="#shallowcopyfilter-type-filter"><code>ShallowCopyFilter</code></a></li>
</ol>
</li>
</ol>
</li>
</ol>
<ol type="1">
<li><a href="#edge-cases">Edge cases</a></li>
</ol>
<ol type="1">
<li><a href="#contributing">Contributing</a><ol type="a">
<li><a href="#tests">Tests</a></li>
</ol>
</li>
</ol>
<h2>How?</h2>
<p>Install with Composer:</p>
<div class="fragment"><div class="line">composer require myclabs/deep-copy</div></div><!-- fragment --><p>Use simply:</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$myCopy = $copier-&gt;copy($myObject);</div></div><!-- fragment --><h2>Why?</h2>
<ul>
<li>How do you create copies of your objects?</li>
</ul>
<div class="fragment"><div class="line">$myCopy = clone $myObject;</div></div><!-- fragment --><ul>
<li>How do you create <b>deep</b> copies of your objects (i.e. copying also all the objects referenced in the properties)?</li>
</ul>
<p>You use <a href="http://www.php.net/manual/en/language.oop5.cloning.php#object.clone"><code>__clone()</code></a> and implement the behavior yourself.</p>
<ul>
<li>But how do you handle <b>cycles</b> in the association graph?</li>
</ul>
<p>Now you're in for a big mess :(</p>
<div class="image">
<img src="doc/graph.png" alt="association graph"/>
</div>
<h3>Using simply <code>clone</code></h3>
<div class="image">
<img src="doc/clone.png" alt="Using clone"/>
</div>
<h3>Overridding <code>__clone()</code></h3>
<div class="image">
<img src="doc/deep-clone.png" alt="Overridding __clone"/>
</div>
<h3>With <code>DeepCopy</code></h3>
<div class="image">
<img src="doc/deep-copy.png" alt="With DeepCopy"/>
</div>
<h2>How it works</h2>
<p>DeepCopy recursively traverses all the object's properties and clones them. To avoid cloning the same object twice it keeps a hash map of all instances and thus preserves the object graph.</p>
<p>To use it:</p>
<div class="fragment"><div class="line">use <span class="keyword">function</span> DeepCopy\deep_copy;</div><div class="line"></div><div class="line">$copy = deep_copy($var);</div></div><!-- fragment --><p>Alternatively, you can create your own <code>DeepCopy</code> instance to configure it differently for example:</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($var);</div></div><!-- fragment --><p>You may want to roll your own deep copy function:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>Acme;</div><div class="line"></div><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line"></div><div class="line"><span class="keyword">function</span> deep_copy($var)</div><div class="line">{</div><div class="line">    <span class="keyword">static</span> $copier = null;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (null === $copier) {</div><div class="line">        $copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>(<span class="keyword">true</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> $copier-&gt;copy($var);</div><div class="line">}</div></div><!-- fragment --><h2>Going further</h2>
<p>You can add filters to customize the copy process.</p>
<p>The method to add a filter is <code>DeepCopy\DeepCopy::addFilter($filter, $matcher)</code>, with <code>$filter</code> implementing <code>DeepCopy\Filter\Filter</code> and <code>$matcher</code> implementing <code>DeepCopy\Matcher\Matcher</code>.</p>
<p>We provide some generic filters and matchers.</p>
<h3>Matchers</h3>
<ul>
<li><code>DeepCopy\Matcher</code> applies on a object attribute.</li>
<li><code>DeepCopy\TypeMatcher</code> applies on any element found in graph, including array elements.</li>
</ul>
<h4>Property name</h4>
<p>The <code>PropertyNameMatcher</code> will match a property by its name:</p>
<div class="fragment"><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyNameMatcher.html">DeepCopy\Matcher\PropertyNameMatcher</a>;</div><div class="line"></div><div class="line"><span class="comment">// Will apply a filter to any property of any objects named &quot;id&quot;</span></div><div class="line">$matcher = <span class="keyword">new</span> PropertyNameMatcher(<span class="stringliteral">&#39;id&#39;</span>);</div></div><!-- fragment --><h4>Specific property</h4>
<p>The <code>PropertyMatcher</code> will match a specific property of a specific class:</p>
<div class="fragment"><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyMatcher.html">DeepCopy\Matcher\PropertyMatcher</a>;</div><div class="line"></div><div class="line"><span class="comment">// Will apply a filter to the property &quot;id&quot; of any objects of the class &quot;MyClass&quot;</span></div><div class="line">$matcher = <span class="keyword">new</span> PropertyMatcher(<span class="stringliteral">&#39;MyClass&#39;</span>, <span class="stringliteral">&#39;id&#39;</span>);</div></div><!-- fragment --><h4>Type</h4>
<p>The <code>TypeMatcher</code> will match any element by its type (instance of a class or any value that could be parameter of <a href="http://php.net/manual/en/function.gettype.php">gettype()</a> function):</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1TypeMatcher_1_1TypeMatcher.html">DeepCopy\TypeMatcher\TypeMatcher</a>;</div><div class="line"></div><div class="line"><span class="comment">// Will apply a filter to any object that is an instance of Doctrine\Common\Collections\Collection</span></div><div class="line">$matcher = <span class="keyword">new</span> TypeMatcher(<span class="stringliteral">&#39;Doctrine\Common\Collections\Collection&#39;</span>);</div></div><!-- fragment --><h3>Filters</h3>
<ul>
<li><code>DeepCopy\Filter</code> applies a transformation to the object attribute matched by <code>DeepCopy\Matcher</code></li>
<li><code>DeepCopy\TypeFilter</code> applies a transformation to any element matched by <code>DeepCopy\TypeMatcher</code></li>
</ul>
<h4><code>SetNullFilter</code> (filter)</h4>
<p>Let's say for example that you are copying a database record (or a Doctrine entity), so you want the copy not to have any ID:</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Filter_1_1SetNullFilter.html">DeepCopy\Filter\SetNullFilter</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyNameMatcher.html">DeepCopy\Matcher\PropertyNameMatcher</a>;</div><div class="line"></div><div class="line">$object = MyClass::load(123);</div><div class="line">echo $object-&gt;id; <span class="comment">// 123</span></div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$copier-&gt;addFilter(<span class="keyword">new</span> SetNullFilter(), <span class="keyword">new</span> PropertyNameMatcher(<span class="stringliteral">&#39;id&#39;</span>));</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($object);</div><div class="line"></div><div class="line">echo $copy-&gt;id; <span class="comment">// null</span></div></div><!-- fragment --><h4><code>KeepFilter</code> (filter)</h4>
<p>If you want a property to remain untouched (for example, an association to an object):</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Filter_1_1KeepFilter.html">DeepCopy\Filter\KeepFilter</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyMatcher.html">DeepCopy\Matcher\PropertyMatcher</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$copier-&gt;addFilter(<span class="keyword">new</span> KeepFilter(), <span class="keyword">new</span> PropertyMatcher(<span class="stringliteral">&#39;MyClass&#39;</span>, <span class="stringliteral">&#39;category&#39;</span>));</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($object);</div><div class="line"><span class="comment">// $copy-&gt;category has not been touched</span></div></div><!-- fragment --><h4><code>DoctrineCollectionFilter</code> (filter)</h4>
<p>If you use Doctrine and want to copy an entity, you will need to use the <code>DoctrineCollectionFilter</code>:</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Filter_1_1Doctrine_1_1DoctrineCollectionFilter.html">DeepCopy\Filter\Doctrine\DoctrineCollectionFilter</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyTypeMatcher.html">DeepCopy\Matcher\PropertyTypeMatcher</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$copier-&gt;addFilter(<span class="keyword">new</span> DoctrineCollectionFilter(), <span class="keyword">new</span> PropertyTypeMatcher(<span class="stringliteral">&#39;Doctrine\Common\Collections\Collection&#39;</span>));</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($object);</div></div><!-- fragment --><h4><code>DoctrineEmptyCollectionFilter</code> (filter)</h4>
<p>If you use Doctrine and want to copy an entity who contains a <code>Collection</code> that you want to be reset, you can use the <code>DoctrineEmptyCollectionFilter</code></p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Filter_1_1Doctrine_1_1DoctrineEmptyCollectionFilter.html">DeepCopy\Filter\Doctrine\DoctrineEmptyCollectionFilter</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyMatcher.html">DeepCopy\Matcher\PropertyMatcher</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$copier-&gt;addFilter(<span class="keyword">new</span> DoctrineEmptyCollectionFilter(), <span class="keyword">new</span> PropertyMatcher(<span class="stringliteral">&#39;MyClass&#39;</span>, <span class="stringliteral">&#39;myProperty&#39;</span>));</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($object);</div><div class="line"></div><div class="line"><span class="comment">// $copy-&gt;myProperty will return an empty collection</span></div></div><!-- fragment --><h4><code>DoctrineProxyFilter</code> (filter)</h4>
<p>If you use Doctrine and use cloning on lazy loaded entities, you might encounter errors mentioning missing fields on a Doctrine proxy class (...\__CG__). You can use the <code>DoctrineProxyFilter</code> to load the actual entity behind the Doctrine proxy class. <b>Make sure, though, to put this as one of your very first filters in the filter chain so that the entity is loaded before other filters are applied!</b></p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Filter_1_1Doctrine_1_1DoctrineProxyFilter.html">DeepCopy\Filter\Doctrine\DoctrineProxyFilter</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1Doctrine_1_1DoctrineProxyMatcher.html">DeepCopy\Matcher\Doctrine\DoctrineProxyMatcher</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$copier-&gt;addFilter(<span class="keyword">new</span> DoctrineProxyFilter(), <span class="keyword">new</span> DoctrineProxyMatcher());</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($object);</div><div class="line"></div><div class="line"><span class="comment">// $copy should now contain a clone of all entities, including those that were not yet fully loaded.</span></div></div><!-- fragment --><h4><code>ReplaceFilter</code> (type filter)</h4>
<ol type="1">
<li>If you want to replace the value of a property:</li>
</ol>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Filter_1_1ReplaceFilter.html">DeepCopy\Filter\ReplaceFilter</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1Matcher_1_1PropertyMatcher.html">DeepCopy\Matcher\PropertyMatcher</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$callback = <span class="keyword">function</span> ($currentValue) {</div><div class="line">  <span class="keywordflow">return</span> $currentValue . <span class="stringliteral">&#39; (copy)&#39;</span></div><div class="line">};</div><div class="line">$copier-&gt;addFilter(<span class="keyword">new</span> ReplaceFilter($callback), <span class="keyword">new</span> PropertyMatcher(<span class="stringliteral">&#39;MyClass&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>));</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy($object);</div><div class="line"></div><div class="line"><span class="comment">// $copy-&gt;title will contain the data returned by the callback, e.g. &#39;The title (copy)&#39;</span></div></div><!-- fragment --><ol type="1">
<li>If you want to replace whole element:</li>
</ol>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1TypeFilter_1_1ReplaceFilter.html">DeepCopy\TypeFilter\ReplaceFilter</a>;</div><div class="line">use <a class="code" href="namespaceDeepCopy_1_1TypeMatcher_1_1TypeMatcher.html">DeepCopy\TypeMatcher\TypeMatcher</a>;</div><div class="line"></div><div class="line">$copier = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$callback = <span class="keyword">function</span> (MyClass $myClass) {</div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespaceget__class.html">get_class</a>($myClass);</div><div class="line">};</div><div class="line">$copier-&gt;addTypeFilter(<span class="keyword">new</span> ReplaceFilter($callback), <span class="keyword">new</span> TypeMatcher(<span class="stringliteral">&#39;MyClass&#39;</span>));</div><div class="line"></div><div class="line">$copy = $copier-&gt;copy([<span class="keyword">new</span> MyClass, <span class="stringliteral">&#39;some string&#39;</span>, <span class="keyword">new</span> MyClass]);</div><div class="line"></div><div class="line"><span class="comment">// $copy will contain [&#39;MyClass&#39;, &#39;some string&#39;, &#39;MyClass&#39;]</span></div></div><!-- fragment --><p>The <code>$callback</code> parameter of the <code>ReplaceFilter</code> constructor accepts any PHP callable.</p>
<h4><code>ShallowCopyFilter</code> (type filter)</h4>
<p>Stop <em>DeepCopy</em> from recursively copying element, using standard <code>clone</code> instead:</p>
<div class="fragment"><div class="line">use <a class="code" href="namespaceDeepCopy_1_1DeepCopy.html">DeepCopy\DeepCopy</a>;</div><div class="line">use <a class="code" href="classDeepCopy_1_1TypeFilter_1_1ShallowCopyFilter.html">DeepCopy\TypeFilter\ShallowCopyFilter</a>;</div><div class="line">use <a class="code" href="namespaceDeepCopy_1_1TypeMatcher_1_1TypeMatcher.html">DeepCopy\TypeMatcher\TypeMatcher</a>;</div><div class="line">use Mockery as m;</div><div class="line"></div><div class="line">$this-&gt;deepCopy = <span class="keyword">new</span> <a class="code" href="namespaceDeepCopy.html">DeepCopy</a>();</div><div class="line">$this-&gt;deepCopy-&gt;addTypeFilter(</div><div class="line">    <span class="keyword">new</span> ShallowCopyFilter,</div><div class="line">    <span class="keyword">new</span> TypeMatcher(m\MockInterface::class)</div><div class="line">);</div><div class="line"></div><div class="line">$myServiceWithMocks = <span class="keyword">new</span> MyService(m::mock(MyDependency1::class), m::mock(MyDependency2::class));</div><div class="line"><span class="comment">// All mocks will be just cloned, not deep copied</span></div></div><!-- fragment --><h2>Edge cases</h2>
<p>The following structures cannot be deep-copied with PHP Reflection. As a result they are shallow cloned and filters are not applied. There is two ways for you to handle them:</p>
<ul>
<li>Implement your own <code>__clone()</code> method</li>
<li>Use a filter with a type matcher</li>
</ul>
<h2>Contributing</h2>
<p>DeepCopy is distributed under the MIT license.</p>
<h3>Tests</h3>
<p>Running the tests is simple:</p>
<div class="fragment"><div class="line">vendor/bin/phpunit</div></div><!-- fragment --><h3>Support</h3>
<p>Get professional support via <a href="https://tidelift.com/subscription/pkg/packagist-myclabs-deep-copy?utm_source=packagist-myclabs-deep-copy&amp;utm_medium=referral&amp;utm_campaign=readme">the Tidelift Subscription</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
